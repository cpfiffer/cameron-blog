<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <!-- All available fonts - swap in CSS to preview -->
        <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:wght@400;600;700&display=swap" rel="stylesheet">
         
        <link rel="stylesheet" href="/libs/highlight/styles/github.min.css">
   <link rel="stylesheet" href="/css/normalize.css" />
<link rel="stylesheet" href="/css/franklin.css" />
<link rel="stylesheet" href="/css/hypertext.css" />
<link rel="icon" href="/assets/favicon.png" />

<!-- Favicon -->
<link
    rel="apple-touch-icon"
    sizes="180x180"
    href="/assets/apple-touch-icon.png"
/>
<link
    rel="icon"
    type="image/png"
    sizes="32x32"
    href="/assets/favicon-32x32.png"
/>
<link
    rel="icon"
    type="image/png"
    sizes="16x16"
    href="/assets/favicon-16x16.png"
/>
<link rel="manifest" href="/assets/site.webmanifest" />
 
        <title>Cool Julia 1.11 features</title>
        
    </head>
    <body>
        
        <nav class="toc-sidebar">
            <div class="toc-content" id="toc-container">
                <!-- TOC will be generated by JavaScript -->
            </div>
        </nav>
        
        <div class="center-column-holder">
            <div class="center-column">
                <header>
    <div class="header-nav">
        <span class="site-name">â—¯ <a href="/" class="site-name-link">Cameron</a></span>
        <div>
            <a href="/">home</a> âˆ˜ <a href="/about">about</a> âˆ˜ <a href="/blog/">blog</a> âˆ˜
            <a href="/links/">links</a>
        </div>
    </div>
    <hr />
</header>

                <!-- Content appended here -->
                <button id="theme-toggle" aria-label="Toggle dark mode">
                    ðŸŒ™
                </button>
            </div>
        </div>
        <style>
            .toc-sidebar {
                position: fixed;
                right: 2rem;
                top: 8rem;
                width: 250px;
                max-height: calc(100vh - 10rem);
                overflow-y: auto;
                font-size: 0.9rem;
                z-index: 100;
            }

            .toc-content {
                background: var(--bg-color, #fff);
                border-left: 2px solid var(--border-color, #ddd);
                padding-left: 1rem;
            }

            .toc-sidebar ul {
                list-style: none;
                padding-left: 0;
                margin: 0;
            }

            .toc-sidebar li {
                margin: 0.4rem 0;
                line-height: 1.4;
            }

            .toc-sidebar ul ul {
                padding-left: 1rem;
                margin-top: 0.2rem;
            }

            .toc-sidebar a {
                color: var(--text-color, #333);
                text-decoration: none;
                display: block;
                padding: 0.2rem 0;
                opacity: 0.7;
                transition: opacity 0.2s;
            }

            .toc-sidebar a:hover {
                opacity: 1;
            }

            /* Hide TOC on smaller screens */
            @media (max-width: 1400px) {
                .toc-sidebar {
                    display: none;
                }
            }

            #theme-toggle {
                position: fixed;
                top: 1rem;
                right: 1rem;
                padding: 0.5rem;
                font-size: 1.25rem;
                border: none;
                background: none;
                cursor: pointer;
                z-index: 1000;
            }
        </style>
        <script>
            // Check for saved theme preference, otherwise use system preference
            const getPreferredTheme = () => {
                const savedTheme = localStorage.getItem("theme");
                if (savedTheme) {
                    return savedTheme;
                }
                return window.matchMedia("(prefers-color-scheme: dark)").matches
                    ? "dark"
                    : "light";
            };

            // Apply theme
            const setTheme = (theme) => {
                document.documentElement.setAttribute("data-theme", theme);
                localStorage.setItem("theme", theme);
                // Update button text
                document.getElementById("theme-toggle").innerText =
                    theme === "dark" ? "â˜¼" : "â˜¾";
            };

            // Initialize theme
            setTheme(getPreferredTheme());

            // Add toggle functionality
            document
                .getElementById("theme-toggle")
                .addEventListener("click", () => {
                    const currentTheme =
                        document.documentElement.getAttribute("data-theme");
                    setTheme(currentTheme === "dark" ? "light" : "dark");
                });

            // Listen for system theme changes
            window
                .matchMedia("(prefers-color-scheme: dark)")
                .addEventListener("change", (e) => {
                    if (!localStorage.getItem("theme")) {
                        setTheme(e.matches ? "dark" : "light");
                    }
                });

            // Generate table of contents
            document.addEventListener("DOMContentLoaded", () => {
                const tocContainer = document.getElementById("toc-container");
                if (!tocContainer) return;

                const headers = document.querySelectorAll(".franklin-content h2, .franklin-content h3");
                if (headers.length === 0) return;

                const tocList = document.createElement("ul");
                let currentH2List = null;

                headers.forEach((header) => {
                    const li = document.createElement("li");
                    const a = document.createElement("a");
                    a.href = `#${header.id}`;
                    a.textContent = header.textContent.trim();

                    li.appendChild(a);

                    if (header.tagName === "H2") {
                        tocList.appendChild(li);
                        currentH2List = null;
                    } else if (header.tagName === "H3") {
                        if (!currentH2List) {
                            currentH2List = document.createElement("ul");
                            const lastH2 = tocList.lastElementChild;
                            if (lastH2) lastH2.appendChild(currentH2List);
                        }
                        currentH2List.appendChild(li);
                    }
                });

                tocContainer.appendChild(tocList);
            });
        </script>
    </body>
</html>
<div class="franklin-content">
<p>There&#39;s some cool Julia features in the <a href="https://github.com/JuliaLang/julia/blob/v1.11.0-alpha2/NEWS.md">NEWS files</a> I thought I&#39;d highlight. Very brief stuff but good to note.</p>
<h2 id="the_memory_type_for_arrays"><a href="#the_memory_type_for_arrays" class="header-anchor">The <code>Memory</code> type for arrays</a></h2>
<p>You can read more about the design of this feature <a href="https://hackmd.io/NnLXBeoyRymWgPtHYlW7-A?view#New-Builtin-functions">here</a>. It&#39;s a really good design doc and I&#39;d recommend taking a look. I&#39;ve summarized it here, but please check it out for a much more thoughtful treatment. Thanks to <a href="https://github.com/oscardssmith">Oscar Smith</a> for the work. </p>
<p>Array types are powerful &#43; general, but have a few shortcomings:</p>
<ul>
<li><p>They use a lot of C, which means the Julia/LLVM compiler can&#39;t work magic</p>
</li>
<li><p>There&#39;s lots of overhead &#40;also due to C calls&#41;</p>
</li>
<li><p><code>push&#33;</code> is slow</p>
</li>
<li><p>No element-wise atomic operations</p>
</li>
</ul>
<p>The <code>Memory</code> type is out, which is a low-level type that is intended to address some of this stuff. Some performance improvements:</p>
<ul>
<li><p>Array appends &#40;<code>push&#33;</code>&#41; are about 2.2x faster</p>
</li>
<li><p>Empty array gen is 3x faster &#40;<code>Int&#91;&#93;</code>&#41;</p>
</li>
<li><p>80&#37; faster for empty <code>Memory</code> implementers <code>Dict&#123;Int,Int&#125;</code></p>
</li>
</ul>
<p>The system image is a little larger.</p>
<h2 id="lockable_for_carrying_locks_with_resources"><a href="#lockable_for_carrying_locks_with_resources" class="header-anchor"><code>Lockable</code> for carrying locks with resources</a></h2>
<p>A common pattern when working with multithreaded code is to use a lock to <a href="https://docs.julialang.org/en/v1/manual/multi-threading/#Data-race-freedom">protect a value</a> from multiple threads accessing it at the same time. For example, you might do something like</p>
<pre><code class="language-julia">x &#61; &#91;1,2,3&#93;
lck &#61; Threads.SpinLock&#40;&#41;

Threads.@threads for i in 1:100
    position &#61; i &#37; 3 &#43; 1
    lock&#40;lck&#41; do
        x&#91;position&#93; &#43;&#61; 1
    end
end</code></pre>
<p>The above code is safe because the <code>lock</code> function ensures that only one thread can access the <code>x</code> array at a time â€“ no data races.</p>
<p><code>Lockable</code> is a super convenient feature where you can attach a lock to a resource, so you don&#39;t have to worry about managing the lock yourself. Here&#39;s an example:</p>
<pre><code class="language-julia">z &#61; Lockable&#40;&#91;1,2,3&#93;, Threads.SpinLock&#40;&#41;&#41;
Threads.@threads for i in 1:100
    position &#61; i &#37; 3 &#43; 1
    lock&#40;z&#41; do x
        x&#91;position&#93; &#43;&#61; 1
    end
end</code></pre>
<p>Notice that now we&#39;re just using <code>lock</code> on the raw resource <code>z</code> and the lock is managed for us. This is a nice feature because it makes the code cleaner and easier to read.</p>
<h2 id="the_public_keyword"><a href="#the_public_keyword" class="header-anchor">The <code>public</code> keyword</a></h2>
<p>The <code>public</code> keyword is applied to symbols that are considered part of the public API of a module, but are not exported when you call <code>using</code>. This is part of the wider discussion in the Julia community that exporting everything is not always the best idea â€“ there&#39;s been a lot of clutter and such with people being trigger-happy about <code>export</code>s. Thanks to <a href="https://github.com/LilithHafner">Lilith Hafner</a> for the work.</p>
<p>As an example, you might have a module like</p>
<pre><code class="language-julia">module MyModule

export foo, bar

foo&#40;&#41; &#61; println&#40;&quot;foo&quot;&#41;
bar&#40;&#41; &#61; println&#40;&quot;bar&quot;&#41;
baz&#40;&#41; &#61; println&#40;&quot;baz&quot;&#41; # not exported, have to use MyModule.baz&#40;&#41;

end # module</code></pre>
<p>when you <code>using MyModule</code>, you get <code>foo</code> and <code>bar</code> directly accessible:</p>
<pre><code class="language-julia">julia&gt; using MyModule

julia&gt; foo&#40;&#41;
foo

julia&gt; bar&#40;&#41;
bar

julia&gt; MyModule.baz&#40;&#41;</code></pre>
<p>Now, you&#39;ll be able to use public functions like <code>foo</code> and <code>bar</code> without having to <code>export</code> them. This is a nice feature because it allows you to keep your module clean and not export everything.</p>
<pre><code class="language-julia">module MyModule

public foo
export bar

foo&#40;&#41; &#61; println&#40;&quot;foo&quot;&#41;
bar&#40;&#41; &#61; println&#40;&quot;bar&quot;&#41;
baz&#40;&#41; &#61; println&#40;&quot;baz&quot;&#41; # not exported, have to use MyModule.baz&#40;&#41;

end # module</code></pre>
<p>Now you&#39;d have the following behavior:</p>
<pre><code class="language-julia">julia&gt; using MyModule

julia&gt; MyModule.foo&#40;&#41; # have to use MyModule.foo&#40;&#41; because it&#39;s not exported
foo

julia&gt; bar&#40;&#41; # can use bar&#40;&#41; directly, as it is exported
bar

julia&gt; MyModule.baz&#40;&#41; # no change
baz</code></pre>
<p>I&#39;m curious to see how the community will use this stuff. I&#39;m not sure it&#39;s immediately obvious to me how I&#39;ll use it, but it seems like standard engineering practice.  </p>
<h2 id="the_greedy_thread_scheduler"><a href="#the_greedy_thread_scheduler" class="header-anchor">The <code>:greedy</code> thread scheduler</a></h2>
<p>You can now use a greedy thread scheduler, which greedily works on iterator elements as they are produced. Greedy threads simply take the next available task in an iterator without regard to how hard the task is, how many threads there are, etc. If you have a lot of tasks that are all about the same difficulty, greedy scheduling can be a good choice. </p>
<pre><code class="language-julia">Threads.@threads :greedy for i in 1:100
    println&#40;i&#41;
end</code></pre>
<p>Julia has the other scheduling options <code>:dynamic</code> and <code>:static</code>, which are more sophisticated and can be more efficient in some cases. <code>:static</code> will partition the iterator into chunks and assign each chunk to a thread, while <code>:dynamic</code> will dynamically allocate small chunks to threads. <code>:dynamic</code> is the default scheduler, but I suspect <code>:greedy</code> will be useful in some repeated, small multithreading tasks.</p>
<p>The <a href="https://github.com/JuliaLang/julia/pull/52096">PR</a> is here. Thanks to <a href="https://seelengrab.github.io/about/">Valentin Bogad/Sukera</a>.</p>
</div><!-- CONTENT ENDS HERE -->

</div> <!-- end of center-column -->
</div> <!-- end of center-column-holder -->
    
    
        <script src="/libs/highlight/highlight.min.js"></script>
<script>hljs.highlightAll();hljs.configure({tabReplace: '    '});</script>

    
    
  </body>
</html>
